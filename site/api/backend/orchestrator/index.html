
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Sistema de dictado por voz local con Whisper">
      
      
        <meta name="author" content="zarvent">
      
      
        <link rel="canonical" href="https://zarvent.github.io/v2m-lab/api/backend/orchestrator/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../api/">
      
      
        
          <link rel="alternate" href="./" hreflang="es">
        
          <link rel="alternate" href="../../../en/api/backend/orchestrator/" hreflang="en">
        
      
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Orchestrator - Voice2Machine</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#orchestrator" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../.." title="Voice2Machine" class="md-header__button md-logo" aria-label="Voice2Machine" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Voice2Machine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Orchestrator
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Seleccionar idioma">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="es" class="md-select__link">
              Espa침ol
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../en/api/backend/orchestrator/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B칰squeda" placeholder="B칰squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b칰squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zarvent/v2m-lab" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zarvent/v2m-lab
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Pesta침as" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  Inicio

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../atajos_teclado/" class="md-tabs__link">
          
  
  
    
  
  Gu칤as

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../referencia_api/" class="md-tabs__link">
          
  
  
    
  
  Referencia

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../arquitectura/" class="md-tabs__link">
          
  
  
    
  
  Arquitectura

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../contribucion/" class="md-tabs__link">
          
  
  
    
  
  Comunidad

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegaci칩n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Voice2Machine" class="md-nav__button md-logo" aria-label="Voice2Machine" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    Voice2Machine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zarvent/v2m-lab" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zarvent/v2m-lab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Inicio
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Inicio
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guia_rapida/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gu칤a R치pida
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../instalacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Instalaci칩n
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuracion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci칩n
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../glosario/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glosario
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Gu칤as
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gu칤as
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../atajos_teclado/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Atajos de Teclado
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Soluci칩n de Problemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Referencia
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Referencia
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../referencia_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API REST
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API Python
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Python
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Daemon
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Daemon
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Orchestrator
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Orchestrator
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#referencia-de-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Referencia de API
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Orchestrator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.clipboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        clipboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.llm_service" class="md-nav__link">
    <span class="md-ellipsis">
      
        llm_service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        notifications
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.recorder" class="md-nav__link">
    <span class="md-ellipsis">
      
        recorder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.transcriber" class="md-nav__link">
    <span class="md-ellipsis">
      
        transcriber
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.worker" class="md-nav__link">
    <span class="md-ellipsis">
      
        worker
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.get_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        process_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        shutdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.start" class="md-nav__link">
    <span class="md-ellipsis">
      
        start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.toggle" class="md-nav__link">
    <span class="md-ellipsis">
      
        toggle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.translate_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        translate_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.warmup" class="md-nav__link">
    <span class="md-ellipsis">
      
        warmup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API REST
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuraci칩n
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transcription/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transcripci칩n
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Servicios LLM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Arquitectura
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Arquitectura
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../arquitectura/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    游빌 Arquitectura del Sistema
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../adr/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Decisiones (ADR)
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Decisiones (ADR)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/001-fastapi-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-001: Migraci칩n de IPC Unix Sockets a FastAPI REST
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/002-orchestrator-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-002: Reemplazo de CQRS/CommandBus por Orchestrator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/003-faster-whisper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-003: Selecci칩n de faster-whisper sobre whisper.cpp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/004-hexagonal-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-004: Arquitectura Hexagonal (Puertos y Adaptadores)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/005-rust-audio-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-005: Motor de Audio en Rust (v2m_engine)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/006-local-first/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-006: Local-first: Procesamiento sin Cloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Comunidad
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Comunidad
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribucion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contribuir
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../style_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gu칤a de Estilo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#referencia-de-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Referencia de API
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Orchestrator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.clipboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        clipboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.llm_service" class="md-nav__link">
    <span class="md-ellipsis">
      
        llm_service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        notifications
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.recorder" class="md-nav__link">
    <span class="md-ellipsis">
      
        recorder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.transcriber" class="md-nav__link">
    <span class="md-ellipsis">
      
        transcriber
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.worker" class="md-nav__link">
    <span class="md-ellipsis">
      
        worker
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.get_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        process_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        shutdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.start" class="md-nav__link">
    <span class="md-ellipsis">
      
        start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.toggle" class="md-nav__link">
    <span class="md-ellipsis">
      
        toggle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.translate_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        translate_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.warmup" class="md-nav__link">
    <span class="md-ellipsis">
      
        warmup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="orchestrator">Orchestrator<a class="headerlink" href="#orchestrator" title="Permanent link">&para;</a></h1>
<p>El Orchestrator es el servicio central que coordina todo el flujo de trabajo de Voice2Machine.</p>
<hr />
<h2 id="referencia-de-api">Referencia de API<a class="headerlink" href="#referencia-de-api" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="v2m.services.orchestrator.Orchestrator" class="doc doc-heading">
            <code>v2m.services.orchestrator.Orchestrator</code>


<a href="#v2m.services.orchestrator.Orchestrator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Orquestador central del sistema Voice2Machine.</p>
<p>Coordina todos los servicios del sistema (audio, transcripci칩n, LLM, clipboard,
notificaciones) usando Lazy Initialization. Reemplaza el patr칩n CQRS + DI Container
con un enfoque m치s directo y f치cil de depurar.</p>
<p>El Orchestrator es el 칰nico punto de entrada para las operaciones de negocio.
FastAPI delega todas las acciones aqu칤, manteniendo los endpoints "tontos".</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="v2m.services.orchestrator.Orchestrator._is_recording">_is_recording</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estado actual de grabaci칩n (True si est치 capturando audio).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="v2m.services.orchestrator.Orchestrator._model_loaded">_model_loaded</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True si el modelo Whisper est치 pre-cargado en VRAM.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="v2m.services.orchestrator.Orchestrator._broadcast_fn">_broadcast_fn</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Funci칩n opcional para emitir eventos a WebSocket clients.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Los servicios pesados (Whisper, LLM) se crean cuando se necesitan por primera
vez, no al inicio. Esto permite que el servidor FastAPI arranque en ~100ms.
Ver: docs/adr/002-orchestrator-pattern.md</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>async def main():
...     orch = Orchestrator()
...     await orch.warmup()  # Pre-cargar Whisper en VRAM
...     response = await orch.toggle()
...     print(response.text)</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="k">class</span><span class="w"> </span><span class="nc">Orchestrator</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Orquestador central del sistema Voice2Machine.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    Coordina todos los servicios del sistema (audio, transcripci칩n, LLM, clipboard,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    notificaciones) usando Lazy Initialization. Reemplaza el patr칩n CQRS + DI Container</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    con un enfoque m치s directo y f치cil de depurar.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    El Orchestrator es el 칰nico punto de entrada para las operaciones de negocio.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    FastAPI delega todas las acciones aqu칤, manteniendo los endpoints &quot;tontos&quot;.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        _is_recording: Estado actual de grabaci칩n (True si est치 capturando audio).</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        _model_loaded: True si el modelo Whisper est치 pre-cargado en VRAM.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        _broadcast_fn: Funci칩n opcional para emitir eventos a WebSocket clients.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        Los servicios pesados (Whisper, LLM) se crean cuando se necesitan por primera</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        vez, no al inicio. Esto permite que el servidor FastAPI arranque en ~100ms.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        Ver: docs/adr/002-orchestrator-pattern.md</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        &gt;&gt;&gt; async def main():</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        ...     orch = Orchestrator()</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        ...     await orch.warmup()  # Pre-cargar Whisper en VRAM</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        ...     response = await orch.toggle()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        ...     print(response.text)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">broadcast_fn</span><span class="p">:</span> <span class="n">BroadcastFn</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa el orquestador con estado limpio y servicios diferidos.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            broadcast_fn: Funci칩n opcional para enviar eventos en tiempo real</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                a clientes WebSocket. Usada para transcripci칩n provisional.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            Los servicios reales (WhisperWorker, AudioRecorder, etc.) no se</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">            crean aqu칤. Se instancian en su primera llamada (Lazy Init).</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="c1"># Estado interno</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_fn</span> <span class="o">=</span> <span class="n">broadcast_fn</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="c1"># Servicios con lazy initialization (None hasta que se usen)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="p">:</span> <span class="n">PersistentWhisperWorker</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_recorder</span><span class="p">:</span> <span class="n">AudioRecorder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transcriber</span><span class="p">:</span> <span class="n">StreamingTranscriber</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_clipboard</span><span class="p">:</span> <span class="n">LinuxClipboardAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="p">:</span> <span class="n">LinuxNotificationService</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Tipo din치mico seg칰n backend</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="c1"># =========================================================================</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Propiedades con Lazy Initialization</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="c1"># =========================================================================</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PersistentWhisperWorker</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el worker de Whisper, cre치ndolo si no existe.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        El worker gestiona el modelo Whisper en VRAM, soportando pol칤ticas</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        de keep-warm para eliminar latencia de carga en fr칤o.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            PersistentWhisperWorker: Instancia configurada seg칰n config.toml.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">            La primera llamada puede tardar varios segundos mientras carga</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">            el modelo en GPU. Usa warmup() en startup para evitar esto.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.persistent_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentWhisperWorker</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">whisper_cfg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">whisper</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span> <span class="o">=</span> <span class="n">PersistentWhisperWorker</span><span class="p">(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">model_size</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">device</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">compute_type</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">compute_type</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">device_index</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">device_index</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">num_workers</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="n">keep_warm</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">keep_warm</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recorder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AudioRecorder</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el grabador de audio, cre치ndolo si no existe.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        Utiliza la extensi칩n Rust (v2m_engine) para captura de baja latencia.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        Ver: docs/adr/005-rust-audio-engine.md</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">            AudioRecorder: Instancia configurada para 16kHz mono (requerido por Whisper).</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.audio.recorder</span><span class="w"> </span><span class="kn">import</span> <span class="n">AudioRecorder</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">whisper_cfg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">transcription</span><span class="o">.</span><span class="n">whisper</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_recorder</span> <span class="o">=</span> <span class="n">AudioRecorder</span><span class="p">(</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="n">sample_rate</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="n">device_index</span><span class="o">=</span><span class="n">whisper_cfg</span><span class="o">.</span><span class="n">audio_device_index</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recorder</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">transcriber</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamingTranscriber</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el transcriptor streaming, cre치ndolo si no existe.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Conecta AudioRecorder  WhisperWorker  WebSocket broadcast para</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        proporcionar transcripci칩n provisional en tiempo real.</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">            StreamingTranscriber: Instancia conectada al worker y recorder.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transcriber</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.streaming_transcriber</span><span class="w"> </span><span class="kn">import</span> <span class="n">StreamingTranscriber</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="c1"># Adapter conecta eventos del transcriptor  WebSocket broadcast</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">session_adapter</span> <span class="o">=</span> <span class="n">WebSocketSessionAdapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_fn</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_transcriber</span> <span class="o">=</span> <span class="n">StreamingTranscriber</span><span class="p">(</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="n">worker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">session_manager</span><span class="o">=</span><span class="n">session_adapter</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">recorder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recorder</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transcriber</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinuxClipboardAdapter</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el servicio de clipboard del sistema.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">            LinuxClipboardAdapter: Wrapper sobre xclip/wl-copy seg칰n el entorno.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clipboard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.linux_adapters</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinuxClipboardAdapter</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_clipboard</span> <span class="o">=</span> <span class="n">LinuxClipboardAdapter</span><span class="p">()</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clipboard</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinuxNotificationService</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el servicio de notificaciones de escritorio.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            LinuxNotificationService: Wrapper sobre notify-send/libnotify.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.notification_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinuxNotificationService</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span> <span class="o">=</span> <span class="n">LinuxNotificationService</span><span class="p">()</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">llm_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el servicio LLM configurado, cre치ndolo si no existe.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        Selecciona el backend seg칰n config.llm.backend:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        - &quot;gemini&quot;: Google Gemini API (cloud)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        - &quot;ollama&quot;: Ollama local</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        - &quot;local&quot;: Modelo embebido</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            LLMService: Instancia del proveedor configurado.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            El tipo de retorno es Any porque los backends tienen interfaces</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            similares pero no id칠nticas. En producci칩n, todos implementan</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">            process_text(str) -&gt; str y translate_text(str, str) -&gt; str.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">backend</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;gemini&quot;</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.gemini_llm_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeminiLLMService</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span> <span class="o">=</span> <span class="n">GeminiLLMService</span><span class="p">()</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;ollama&quot;</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.ollama_llm_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaLLMService</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span> <span class="o">=</span> <span class="n">OllamaLLMService</span><span class="p">()</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># &quot;local&quot;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.infrastructure.local_llm_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalLLMService</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span> <span class="o">=</span> <span class="n">LocalLLMService</span><span class="p">()</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LLM backend inicializado: </span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="c1"># =========================================================================</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="c1"># M칠todos P칰blicos (API Surface)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="c1"># =========================================================================</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pre-carga el modelo Whisper en VRAM para eliminar latencia de arranque.</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        Ejecuta la inicializaci칩n sincr칩nica del worker en un executor para no</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        bloquear el event loop. Debe llamarse durante el lifecycle startup de</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        FastAPI para tener el modelo &quot;caliente&quot; antes de la primera transcripci칩n.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">            RuntimeError: Si el worker no puede inicializarse (error silenciado</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">                en logs, el modelo se cargar치 on-demand si falla aqu칤).</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">            &gt;&gt;&gt; @asynccontextmanager</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">            ... async def lifespan(app: FastAPI):</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">            ...     await orchestrator.warmup()</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">            ...     yield</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="k">return</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="c1"># Warmup sincr칩nico en el executor del worker</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">initialize_sync</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;九 Modelo Whisper precargado en VRAM&quot;</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;仇 Error en warmup del modelo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="c1"># No re-lanzamos - el modelo se cargar치 on-demand</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Alterna el estado de grabaci칩n del sistema.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        Gestiona la l칩gica de cambio de estado: si el sistema est치 en reposo</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        (idle), inicia la captura de audio y el streaming. Si est치 grabando,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        detiene la captura, finaliza la transcripci칩n y copia al portapapeles.</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        Este es el endpoint principal usado por los atajos de teclado.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">            ToggleResponse: Objeto con el nuevo estado del sistema y, en caso</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">                de detenerse, el texto final transcrito.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">            RuntimeError: Si los servicios de backend (Whisper/Audio) no responden.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">                (Error capturado internamente y reportado en ToggleResponse.message)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">            &gt;&gt;&gt; response = await orchestrator.toggle()</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">            &gt;&gt;&gt; if response.status == &quot;idle&quot; and response.text:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">            ...     print(f&quot;Transcrito: {response.text}&quot;)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicia la grabaci칩n de audio y el streaming de transcripci칩n.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Activa el AudioRecorder y el StreamingTranscriber. Crea un archivo</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        flag en disco para que scripts externos puedan detectar el estado.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">            ToggleResponse: Confirmaci칩n de inicio con status=&#39;recording&#39;.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">            RuntimeError: Si ya hay una grabaci칩n en curso o el micr칩fono</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">                no est치 disponible. (Error capturado en response.message)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">            Si ya est치 grabando, retorna inmediatamente sin error.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToggleResponse</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;丘멆잺 Ya est치 grabando&quot;</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="c1"># Iniciar streaming transcriber</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcriber</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="c1"># Crear flag file para scripts externos</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="c1"># Notificar al usuario</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;游꿗 voice2machine&quot;</span><span class="p">,</span> <span class="s2">&quot;grabaci칩n iniciada...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;游꿏勇 Grabaci칩n iniciada&quot;</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;游꿏勇 Grabando...&quot;</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error iniciando grabaci칩n: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;仇 Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detiene la grabaci칩n, finaliza transcripci칩n y copia al portapapeles.</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        Detiene el AudioRecorder, procesa el audio capturado con Whisper,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        y copia el texto resultante al portapapeles del sistema.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">            ToggleResponse: Resultado con status=&#39;idle&#39; y el texto transcrito</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">                en el campo &#39;text&#39;. Si no se detect칩 voz, text=None.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">            RuntimeError: Si no hay grabaci칩n en curso o Whisper falla.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">                (Error capturado en response.message)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            &gt;&gt;&gt; response = await orchestrator.stop()</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            &gt;&gt;&gt; if response.text:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            ...     print(f&quot;Copiado: {response.text}&quot;)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToggleResponse</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;丘멆잺 No hay grabaci칩n en curso&quot;</span><span class="p">,</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="c1"># Eliminar flag file</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="c1"># Notificar procesamiento</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;丘 v2m procesando&quot;</span><span class="p">,</span> <span class="s2">&quot;procesando...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="c1"># Detener y obtener transcripci칩n</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcriber</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="c1"># Validar resultado</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">transcription</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">transcription</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;仇 whisper&quot;</span><span class="p">,</span> <span class="s2">&quot;no se detect칩 voz en el audio&quot;</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                    <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;仇 No se detect칩 voz&quot;</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                    <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                <span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="c1"># Copiar al portapapeles</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="c1"># Notificar 칠xito</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="n">preview</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;九 whisper - copiado&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">preview</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;九 Transcripci칩n completada: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;九 Copiado al portapapeles&quot;</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="n">text</span><span class="o">=</span><span class="n">transcription</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deteniendo grabaci칩n: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;仇 Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Procesa texto con LLM para limpieza, puntuaci칩n y formato.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        Env칤a el texto al backend LLM configurado (Gemini/Ollama/local) para</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        refinamiento. El resultado se copia autom치ticamente al portapapeles.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">            text: Texto crudo a procesar (t칤picamente output de Whisper).</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">            LLMResponse: Texto refinado y nombre del backend usado.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">                Si el LLM falla, retorna el texto original como fallback.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">            ValueError: Si el texto est치 vac칤o (capturado internamente).</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">            &gt;&gt;&gt; response = await orchestrator.process_text(&quot;hola como estas&quot;)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">            &gt;&gt;&gt; print(response.text)  # &quot;Hola, 쯖칩mo est치s?&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMResponse</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">backend_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="c1"># El servicio LLM puede ser sync o async</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">):</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                <span class="n">refined</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="n">refined</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="c1"># Copiar al portapapeles</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;九 </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> - copiado&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refined</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">refined</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend_name</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error procesando texto con </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="c1"># Fallback: copiar texto original</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;丘멆잺 </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> fall칩&quot;</span><span class="p">,</span> <span class="s2">&quot;usando texto original...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> (fallback)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">translate_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span><span class="p">:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Traduce texto a otro idioma usando el LLM configurado.</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">        Valida el idioma destino para prevenir inyecci칩n de prompts maliciosos,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">        luego delega al backend LLM para traducci칩n.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">            text: Texto a traducir en cualquier idioma.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">            target_lang: C칩digo o nombre del idioma destino (ej. &#39;en&#39;, &#39;espa침ol&#39;).</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">                Debe coincidir con regex: ^[a-zA-Z\s\-]{2,20}$</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">            LLMResponse: Texto traducido y backend usado.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">                Si hay error, retorna texto original con backend=&#39;error&#39;.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">            ValueError: Si target_lang tiene caracteres inv치lidos (sanitizado).</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">            &gt;&gt;&gt; response = await orchestrator.translate_text(&quot;Buenos d칤as&quot;, &quot;en&quot;)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">            &gt;&gt;&gt; print(response.text)  # &quot;Good morning&quot;</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMResponse</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">backend_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="c1"># Validar target_lang para prevenir inyecci칩n</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z\s\-]{2,20}$&quot;</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">):</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Idioma inv치lido: </span><span class="si">{</span><span class="n">target_lang</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;仇 Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Idioma de destino inv치lido&quot;</span><span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">):</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                <span class="n">translated</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                <span class="n">translated</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">translated</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;九 Traducci칩n (</span><span class="si">{</span><span class="n">target_lang</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">translated</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">translated</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend_name</span><span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error traduciendo con </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;仇 Error traducci칩n&quot;</span><span class="p">,</span> <span class="s2">&quot;Fallo al traducir&quot;</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> (error)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusResponse</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retorna el estado actual del daemon de forma sincr칩nica.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        M칠todo ligero sin I/O, 칰til para health checks y polling.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            StatusResponse: Estado de grabaci칩n (&#39;idle&#39;|&#39;recording&#39;),</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">                flag booleano de grabaci칩n, y si el modelo est치 cargado.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">            &gt;&gt;&gt; status = orchestrator.get_status()</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">            &gt;&gt;&gt; if status.model_loaded:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">            ...     print(&quot;Whisper listo&quot;)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">StatusResponse</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;recording&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="k">else</span> <span class="s2">&quot;idle&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="k">return</span> <span class="n">StatusResponse</span><span class="p">(</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="n">recording</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="n">model_loaded</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Libera todos los recursos al apagar el servidor.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        Detiene grabaci칩n activa, descarga el modelo de VRAM, y cierra</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        servicios de notificaciones. Llamado autom치ticamente en el</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        lifecycle shutdown de FastAPI.</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">            Los errores se logean pero no se re-lanzan para asegurar</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">            un apagado limpio incluso con fallos parciales.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">            &gt;&gt;&gt; @asynccontextmanager</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">            ... async def lifespan(app: FastAPI):</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">            ...     await orchestrator.warmup()</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">            ...     yield</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">            ...     await orchestrator.shutdown()</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Liberando recursos del orquestador...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="c1"># Detener grabaci칩n si est치 activa</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="c1"># Descargar modelo de VRAM</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="p">:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="o">.</span><span class="n">unload</span><span class="p">()</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error descargando modelo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="c1"># Cerrar servicio de notificaciones</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;九 Recursos liberados&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.clipboard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clipboard</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.clipboard" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el servicio de clipboard del sistema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LinuxClipboardAdapter</code></td>            <td>
                  <code><span title="v2m.infrastructure.linux_adapters.LinuxClipboardAdapter">LinuxClipboardAdapter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapper sobre xclip/wl-copy seg칰n el entorno.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.llm_service" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">llm_service</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.llm_service" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el servicio LLM configurado, cre치ndolo si no existe.</p>
<p>Selecciona el backend seg칰n config.llm.backend:
- "gemini": Google Gemini API (cloud)
- "ollama": Ollama local
- "local": Modelo embebido</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LLMService</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia del proveedor configurado.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>El tipo de retorno es Any porque los backends tienen interfaces
similares pero no id칠nticas. En producci칩n, todos implementan
process_text(str) -&gt; str y translate_text(str, str) -&gt; str.</p>
</details>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.notifications" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">notifications</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.notifications" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el servicio de notificaciones de escritorio.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LinuxNotificationService</code></td>            <td>
                  <code><span title="v2m.infrastructure.notification_service.LinuxNotificationService">LinuxNotificationService</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapper sobre notify-send/libnotify.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.recorder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recorder</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.recorder" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el grabador de audio, cre치ndolo si no existe.</p>
<p>Utiliza la extensi칩n Rust (v2m_engine) para captura de baja latencia.
Ver: docs/adr/005-rust-audio-engine.md</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>AudioRecorder</code></td>            <td>
                  <code><span title="v2m.infrastructure.audio.recorder.AudioRecorder">AudioRecorder</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia configurada para 16kHz mono (requerido por Whisper).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.transcriber" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transcriber</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.transcriber" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el transcriptor streaming, cre치ndolo si no existe.</p>
<p>Conecta AudioRecorder  WhisperWorker  WebSocket broadcast para
proporcionar transcripci칩n provisional en tiempo real.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StreamingTranscriber</code></td>            <td>
                  <code><span title="v2m.infrastructure.streaming_transcriber.StreamingTranscriber">StreamingTranscriber</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia conectada al worker y recorder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.worker" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">worker</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.worker" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el worker de Whisper, cre치ndolo si no existe.</p>
<p>El worker gestiona el modelo Whisper en VRAM, soportando pol칤ticas
de keep-warm para eliminar latencia de carga en fr칤o.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PersistentWhisperWorker</code></td>            <td>
                  <code><span title="v2m.infrastructure.persistent_model.PersistentWhisperWorker">PersistentWhisperWorker</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia configurada seg칰n config.toml.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>La primera llamada puede tardar varios segundos mientras carga
el modelo en GPU. Usa warmup() en startup para evitar esto.</p>
</details>
    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">broadcast_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#v2m.services.orchestrator.Orchestrator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Inicializa el orquestador con estado limpio y servicios diferidos.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>broadcast_fn</code>
            </td>
            <td>
                  <code><span title="v2m.services.orchestrator.BroadcastFn">BroadcastFn</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Funci칩n opcional para enviar eventos en tiempo real
a clientes WebSocket. Usada para transcripci칩n provisional.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Los servicios reales (WhisperWorker, AudioRecorder, etc.) no se
crean aqu칤. Se instancian en su primera llamada (Lazy Init).</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">broadcast_fn</span><span class="p">:</span> <span class="n">BroadcastFn</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa el orquestador con estado limpio y servicios diferidos.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        broadcast_fn: Funci칩n opcional para enviar eventos en tiempo real</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            a clientes WebSocket. Usada para transcripci칩n provisional.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        Los servicios reales (WhisperWorker, AudioRecorder, etc.) no se</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        crean aqu칤. Se instancian en su primera llamada (Lazy Init).</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="c1"># Estado interno</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_fn</span> <span class="o">=</span> <span class="n">broadcast_fn</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="c1"># Servicios con lazy initialization (None hasta que se usen)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="p">:</span> <span class="n">PersistentWhisperWorker</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_recorder</span><span class="p">:</span> <span class="n">AudioRecorder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_transcriber</span><span class="p">:</span> <span class="n">StreamingTranscriber</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_clipboard</span><span class="p">:</span> <span class="n">LinuxClipboardAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="p">:</span> <span class="n">LinuxNotificationService</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Tipo din치mico seg칰n backend</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.get_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_status</span><span class="p">()</span></code>

<a href="#v2m.services.orchestrator.Orchestrator.get_status" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retorna el estado actual del daemon de forma sincr칩nica.</p>
<p>M칠todo ligero sin I/O, 칰til para health checks y polling.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StatusResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.StatusResponse" href="../api/#v2m.api.StatusResponse">StatusResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estado de grabaci칩n ('idle'|'recording'),
flag booleano de grabaci칩n, y si el modelo est치 cargado.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>status = orchestrator.get_status()
if status.model_loaded:
...     print("Whisper listo")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusResponse</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retorna el estado actual del daemon de forma sincr칩nica.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    M칠todo ligero sin I/O, 칰til para health checks y polling.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        StatusResponse: Estado de grabaci칩n (&#39;idle&#39;|&#39;recording&#39;),</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">            flag booleano de grabaci칩n, y si el modelo est치 cargado.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        &gt;&gt;&gt; status = orchestrator.get_status()</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">        &gt;&gt;&gt; if status.model_loaded:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        ...     print(&quot;Whisper listo&quot;)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">StatusResponse</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;recording&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="k">else</span> <span class="s2">&quot;idle&quot;</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="k">return</span> <span class="n">StatusResponse</span><span class="p">(</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="n">recording</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">model_loaded</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.process_text" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Procesa texto con LLM para limpieza, puntuaci칩n y formato.</p>
<p>Env칤a el texto al backend LLM configurado (Gemini/Ollama/local) para
refinamiento. El resultado se copia autom치ticamente al portapapeles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto crudo a procesar (t칤picamente output de Whisper).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LLMResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.LLMResponse" href="../api/#v2m.api.LLMResponse">LLMResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto refinado y nombre del backend usado.
Si el LLM falla, retorna el texto original como fallback.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si el texto est치 vac칤o (capturado internamente).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.process_text("hola como estas")
print(response.text)  # "Hola, 쯖칩mo est치s?"</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Procesa texto con LLM para limpieza, puntuaci칩n y formato.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    Env칤a el texto al backend LLM configurado (Gemini/Ollama/local) para</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    refinamiento. El resultado se copia autom치ticamente al portapapeles.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        text: Texto crudo a procesar (t칤picamente output de Whisper).</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">        LLMResponse: Texto refinado y nombre del backend usado.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">            Si el LLM falla, retorna el texto original como fallback.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        ValueError: Si el texto est치 vac칤o (capturado internamente).</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        &gt;&gt;&gt; response = await orchestrator.process_text(&quot;hola como estas&quot;)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        &gt;&gt;&gt; print(response.text)  # &quot;Hola, 쯖칩mo est치s?&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMResponse</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="n">backend_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="c1"># El servicio LLM puede ser sync o async</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">):</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="n">refined</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">refined</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="c1"># Copiar al portapapeles</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;九 </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> - copiado&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refined</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">refined</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend_name</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error procesando texto con </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="c1"># Fallback: copiar texto original</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;丘멆잺 </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> fall칩&quot;</span><span class="p">,</span> <span class="s2">&quot;usando texto original...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> (fallback)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.shutdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shutdown</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.shutdown" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Libera todos los recursos al apagar el servidor.</p>
<p>Detiene grabaci칩n activa, descarga el modelo de VRAM, y cierra
servicios de notificaciones. Llamado autom치ticamente en el
lifecycle shutdown de FastAPI.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Los errores se logean pero no se re-lanzan para asegurar
un apagado limpio incluso con fallos parciales.</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>@asynccontextmanager
... async def lifespan(app: FastAPI):
...     await orchestrator.warmup()
...     yield
...     await orchestrator.shutdown()</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Libera todos los recursos al apagar el servidor.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    Detiene grabaci칩n activa, descarga el modelo de VRAM, y cierra</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">    servicios de notificaciones. Llamado autom치ticamente en el</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    lifecycle shutdown de FastAPI.</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        Los errores se logean pero no se re-lanzan para asegurar</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        un apagado limpio incluso con fallos parciales.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        &gt;&gt;&gt; @asynccontextmanager</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        ... async def lifespan(app: FastAPI):</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        ...     await orchestrator.warmup()</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">        ...     yield</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        ...     await orchestrator.shutdown()</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Liberando recursos del orquestador...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>    <span class="c1"># Detener grabaci칩n si est치 activa</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="c1"># Descargar modelo de VRAM</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="p">:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="o">.</span><span class="n">unload</span><span class="p">()</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error descargando modelo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="c1"># Cerrar servicio de notificaciones</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;九 Recursos liberados&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.start" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Inicia la grabaci칩n de audio y el streaming de transcripci칩n.</p>
<p>Activa el AudioRecorder y el StreamingTranscriber. Crea un archivo
flag en disco para que scripts externos puedan detectar el estado.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ToggleResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.ToggleResponse" href="../api/#v2m.api.ToggleResponse">ToggleResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Confirmaci칩n de inicio con status='recording'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si ya hay una grabaci칩n en curso o el micr칩fono
no est치 disponible. (Error capturado en response.message)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Si ya est치 grabando, retorna inmediatamente sin error.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicia la grabaci칩n de audio y el streaming de transcripci칩n.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Activa el AudioRecorder y el StreamingTranscriber. Crea un archivo</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    flag en disco para que scripts externos puedan detectar el estado.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        ToggleResponse: Confirmaci칩n de inicio con status=&#39;recording&#39;.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        RuntimeError: Si ya hay una grabaci칩n en curso o el micr칩fono</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            no est치 disponible. (Error capturado en response.message)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        Si ya est치 grabando, retorna inmediatamente sin error.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToggleResponse</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;丘멆잺 Ya est치 grabando&quot;</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="c1"># Iniciar streaming transcriber</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcriber</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="c1"># Crear flag file para scripts externos</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="c1"># Notificar al usuario</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;游꿗 voice2machine&quot;</span><span class="p">,</span> <span class="s2">&quot;grabaci칩n iniciada...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;游꿏勇 Grabaci칩n iniciada&quot;</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;游꿏勇 Grabando...&quot;</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error iniciando grabaci칩n: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;仇 Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.stop" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Detiene la grabaci칩n, finaliza transcripci칩n y copia al portapapeles.</p>
<p>Detiene el AudioRecorder, procesa el audio capturado con Whisper,
y copia el texto resultante al portapapeles del sistema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ToggleResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.ToggleResponse" href="../api/#v2m.api.ToggleResponse">ToggleResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resultado con status='idle' y el texto transcrito
en el campo 'text'. Si no se detect칩 voz, text=None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si no hay grabaci칩n en curso o Whisper falla.
(Error capturado en response.message)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.stop()
if response.text:
...     print(f"Copiado: {response.text}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Detiene la grabaci칩n, finaliza transcripci칩n y copia al portapapeles.</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    Detiene el AudioRecorder, procesa el audio capturado con Whisper,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    y copia el texto resultante al portapapeles del sistema.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        ToggleResponse: Resultado con status=&#39;idle&#39; y el texto transcrito</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">            en el campo &#39;text&#39;. Si no se detect칩 voz, text=None.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        RuntimeError: Si no hay grabaci칩n en curso o Whisper falla.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">            (Error capturado en response.message)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        &gt;&gt;&gt; response = await orchestrator.stop()</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        &gt;&gt;&gt; if response.text:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        ...     print(f&quot;Copiado: {response.text}&quot;)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToggleResponse</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;丘멆잺 No hay grabaci칩n en curso&quot;</span><span class="p">,</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="c1"># Eliminar flag file</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="c1"># Notificar procesamiento</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;丘 v2m procesando&quot;</span><span class="p">,</span> <span class="s2">&quot;procesando...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="c1"># Detener y obtener transcripci칩n</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcriber</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="c1"># Validar resultado</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">transcription</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">transcription</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;仇 whisper&quot;</span><span class="p">,</span> <span class="s2">&quot;no se detect칩 voz en el audio&quot;</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;仇 No se detect칩 voz&quot;</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="c1"># Copiar al portapapeles</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="c1"># Notificar 칠xito</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="n">preview</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;九 whisper - copiado&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">preview</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;九 Transcripci칩n completada: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;九 Copiado al portapapeles&quot;</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">text</span><span class="o">=</span><span class="n">transcription</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deteniendo grabaci칩n: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;仇 Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.toggle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">toggle</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.toggle" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Alterna el estado de grabaci칩n del sistema.</p>
<p>Gestiona la l칩gica de cambio de estado: si el sistema est치 en reposo
(idle), inicia la captura de audio y el streaming. Si est치 grabando,
detiene la captura, finaliza la transcripci칩n y copia al portapapeles.</p>
<p>Este es el endpoint principal usado por los atajos de teclado.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ToggleResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.ToggleResponse" href="../api/#v2m.api.ToggleResponse">ToggleResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Objeto con el nuevo estado del sistema y, en caso
de detenerse, el texto final transcrito.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si los servicios de backend (Whisper/Audio) no responden.
(Error capturado internamente y reportado en ToggleResponse.message)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.toggle()
if response.status == "idle" and response.text:
...     print(f"Transcrito: {response.text}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alterna el estado de grabaci칩n del sistema.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    Gestiona la l칩gica de cambio de estado: si el sistema est치 en reposo</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    (idle), inicia la captura de audio y el streaming. Si est치 grabando,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    detiene la captura, finaliza la transcripci칩n y copia al portapapeles.</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    Este es el endpoint principal usado por los atajos de teclado.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        ToggleResponse: Objeto con el nuevo estado del sistema y, en caso</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">            de detenerse, el texto final transcrito.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        RuntimeError: Si los servicios de backend (Whisper/Audio) no responden.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">            (Error capturado internamente y reportado en ToggleResponse.message)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        &gt;&gt;&gt; response = await orchestrator.toggle()</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        &gt;&gt;&gt; if response.status == &quot;idle&quot; and response.text:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        ...     print(f&quot;Transcrito: {response.text}&quot;)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.translate_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.translate_text" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Traduce texto a otro idioma usando el LLM configurado.</p>
<p>Valida el idioma destino para prevenir inyecci칩n de prompts maliciosos,
luego delega al backend LLM para traducci칩n.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto a traducir en cualquier idioma.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_lang</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>C칩digo o nombre del idioma destino (ej. 'en', 'espa침ol').
Debe coincidir con regex: ^[a-zA-Z\s-]{2,20}$</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LLMResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.LLMResponse" href="../api/#v2m.api.LLMResponse">LLMResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto traducido y backend usado.
Si hay error, retorna texto original con backend='error'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si target_lang tiene caracteres inv치lidos (sanitizado).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.translate_text("Buenos d칤as", "en")
print(response.text)  # "Good morning"</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">translate_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span><span class="p">:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Traduce texto a otro idioma usando el LLM configurado.</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    Valida el idioma destino para prevenir inyecci칩n de prompts maliciosos,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    luego delega al backend LLM para traducci칩n.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        text: Texto a traducir en cualquier idioma.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        target_lang: C칩digo o nombre del idioma destino (ej. &#39;en&#39;, &#39;espa침ol&#39;).</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">            Debe coincidir con regex: ^[a-zA-Z\s\-]{2,20}$</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        LLMResponse: Texto traducido y backend usado.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">            Si hay error, retorna texto original con backend=&#39;error&#39;.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">        ValueError: Si target_lang tiene caracteres inv치lidos (sanitizado).</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        &gt;&gt;&gt; response = await orchestrator.translate_text(&quot;Buenos d칤as&quot;, &quot;en&quot;)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        &gt;&gt;&gt; print(response.text)  # &quot;Good morning&quot;</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMResponse</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="n">backend_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="c1"># Validar target_lang para prevenir inyecci칩n</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z\s\-]{2,20}$&quot;</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">):</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Idioma inv치lido: </span><span class="si">{</span><span class="n">target_lang</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;仇 Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Idioma de destino inv치lido&quot;</span><span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">):</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="n">translated</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="n">translated</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">translated</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;九 Traducci칩n (</span><span class="si">{</span><span class="n">target_lang</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">translated</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">translated</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend_name</span><span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error traduciendo con </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;仇 Error traducci칩n&quot;</span><span class="p">,</span> <span class="s2">&quot;Fallo al traducir&quot;</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> (error)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.warmup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warmup</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.warmup" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pre-carga el modelo Whisper en VRAM para eliminar latencia de arranque.</p>
<p>Ejecuta la inicializaci칩n sincr칩nica del worker en un executor para no
bloquear el event loop. Debe llamarse durante el lifecycle startup de
FastAPI para tener el modelo "caliente" antes de la primera transcripci칩n.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si el worker no puede inicializarse (error silenciado
en logs, el modelo se cargar치 on-demand si falla aqu칤).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>@asynccontextmanager
... async def lifespan(app: FastAPI):
...     await orchestrator.warmup()
...     yield</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-carga el modelo Whisper en VRAM para eliminar latencia de arranque.</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    Ejecuta la inicializaci칩n sincr칩nica del worker en un executor para no</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    bloquear el event loop. Debe llamarse durante el lifecycle startup de</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    FastAPI para tener el modelo &quot;caliente&quot; antes de la primera transcripci칩n.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        RuntimeError: Si el worker no puede inicializarse (error silenciado</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">            en logs, el modelo se cargar치 on-demand si falla aqu칤).</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        &gt;&gt;&gt; @asynccontextmanager</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        ... async def lifespan(app: FastAPI):</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        ...     await orchestrator.warmup()</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        ...     yield</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="k">return</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="c1"># Warmup sincr칩nico en el executor del worker</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">initialize_sync</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;九 Modelo Whisper precargado en VRAM&quot;</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;仇 Error en warmup del modelo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_source: true
members: - <strong>init</strong> - toggle - start - stop - warmup - shutdown - get_status - process_text - translate_text</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="칔ltima actualizaci칩n">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="21 de enero de 2026 02:04:24 UTC"><span class="timeago" datetime="2026-01-21T02:04:24+00:00" locale="es"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="21 de enero de 2026 02:04:24 UTC">2026-01-21</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2026 Voice2Machine Contributors
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/zarvent/v2m-lab" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.indexes", "content.code.copy", "content.code.annotate", "search.highlight", "search.suggest"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>